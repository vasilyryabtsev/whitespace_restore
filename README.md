# Восстановление пропущенных пробелов в тексте

## Описание подхода

Повторил подход из статьи [Fast Whitespace Correction with Encoder-Only Transformers](https://aclanthology.org/2023.acl-demo.37.pdf#:~:text=The%20goal%20of%20whitespace%20correction,We%20compare) с некоторыми изменениями:

- Использовал только подход EO (Encoder-Only), без Seq2Seq модели, так как этот подход показал лучшие результаты по бенчмаркам из статьи. 
- Из-за ограничений по ресурсам, я решил отказаться от полного обучения энкодера BERT и использовал предобученную модель ByT5-small в качестве энкодера с дообучением энкодера и головы классификатора на 3-х эпохах.
- Максимальная длина токенизатора 128 токенов, вместо 512 как в статье, это сделано также с целью экономии ресурсов.
- Обучал классификатор только для двух классов: 0 - не добавлять пробел после символа, 1 - добавлять пробел после символа. В статье использовались 3 класса, но я решил упростить задачу. Также в статье предсказывался пробел до символа, а не после.
- Модель дообучена на корпусе русскоязычных новостей, где помимо основного русского текста часто встречаются бренды и англоязычные вкрапления, что отражает специфику задачи. Перед обучением я разрезал тексты на фрагменты длиной не более 65 символов. Итоговый датасет превысил 600k документов: [whitespace-restore](https://www.kaggle.com/datasets/vasilyryabtsev/whitespace-restore).

## Быстрый старт

### 1. Клонирование репозитория
```bash
git clone https://github.com/vasilyryabtsev/whitespace_restore.git
cd whitespace_restore
```

### 2. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 3. Настройка окружения
Создайте файл `.env` в корне проекта и заполните следующие переменные:

```env
# Путь к данным для инференса (CSV файл)
PATH_TO_DATA=/path/to/your/data.csv

# Путь для сохранения результатов
PATH_TO_SAVE=/path/to/save/results.csv

# Устройство для вычислений
DEVICE=cuda  # или cpu (если нет GPU)

# Параметры инференса (опционально)
BATCH_SIZE=16
NUM_WORKERS=1
```

### 4. Подготовка данных
Ваш CSV файл должен содержать колонку с текстами без пробелов:
```csv
id,text_no_spaces
1,"Приветмир!Какдела?"
2,"Этопримертекстабезпробелов"
```

### 5. Запуск инференса
```bash
python run_inference.py
```

### Результат
После выполнения в указанном файле `PATH_TO_SAVE` будет создан CSV с результатами:
```csv
id,predicted_positions
0,"[6, 10, 13]"
1,"[3, 10, 16]"
```

Где `predicted_positions` - список индексов символов, после которых нужно вставить пробелы.

## Структура проекта
```
whitespace_restore/
├── src/
│   ├── __init__.py
│   ├── api.py          # Функции для инференса
│   ├── dataset.py      # Класс датасета
│   ├── model.py        # Архитектура модели
│   ├── trainer.py      # Функции обучения
│   └── utils.py        # Вспомогательные функции
├── run_inference.py    # Скрипт запуска инференса
├── requirements.txt    # Зависимости
└── README.md
```
